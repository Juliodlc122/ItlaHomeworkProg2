@model client_mvc.Models.InventarioProductoFormModel
@{
    ViewData["Title"] = "Editar Producto";
    Layout = "_Layout";
}

<div class="container mt-4">
    <h2>Editar Producto</h2>

    @if (TempData["ApiError"] != null) { <div class="alert alert-danger">@TempData["ApiError"]</div> }

    <form asp-action="Editar" asp-route-id="@Model.Id" method="post" enctype="multipart/form-data">
        <div class="row g-2">
            <div class="col-md-6">
                <label>Nombre</label>
                <input asp-for="Nombre" class="form-control" />
            </div>
            <div class="col-md-3">
                <label>Tipo</label>
                <select asp-for="Tipo" class="form-select">
                    <option>Camisa</option>
                    <option>Pantalon</option>
                    <option>Zapato</option>
                </select>
            </div>
            <div class="col-md-3">
                <label>Talla</label>
                <input asp-for="Talla" class="form-control" />
            </div>

            <div class="col-md-4">
                <label>Precio</label>
                <input asp-for="Precio" class="form-control" />
            </div>
            <div class="col-md-4">
                <label>Precio Original</label>
                <input asp-for="PrecioOriginal" class="form-control" />
            </div>
            <div class="col-md-4">
                <label>Stock</label>
                <input asp-for="Stock" class="form-control" type="number" />
            </div>

            <div class="col-md-6">
                <label>Material / TipoCorte</label>
                <input asp-for="Material" class="form-control" />
            </div>

            <div class="col-md-3">
                <label>Descuento (%)</label>
                <input asp-for="DescuentoPorcentaje" class="form-control" />
            </div>

            <div class="col-md-3">
                <label>Temporada (ID)</label>
                <input asp-for="TemporadaId" class="form-control" />
            </div>

            <div class="col-12">
                <label>Imagen actual</label><br />
                @if (!string.IsNullOrEmpty(Model.ImagenUrl))
                {
                    <img src="@Model.ImagenUrl" alt="Imagen" style="height:96px;object-fit:cover;" />
                }
                <div class="mt-2">
                    <label>Nueva Imagen</label>
                    <input id="fileInput" type="file" accept="image/*" class="form-control" />
                    <input type="hidden" asp-for="ImagenBase64" id="ImagenBase64" />
                    <input type="hidden" asp-for="ImagenFileName" id="ImagenFileName" />
                </div>
            </div>

            <div class="col-12 mt-3">
                <button type="submit" class="btn btn-success">Guardar cambios</button>
                <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.getElementById('fileInput').addEventListener('change', function (ev) {
            const f = ev.target.files[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('ImagenBase64').value = e.target.result;
                document.getElementById('ImagenFileName').value = f.name;
            };
            reader.readAsDataURL(f);
        });
    </script>
}
